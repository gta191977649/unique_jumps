local Jump = false 
local GameSpeed = false

local Unique_Jumps = {
-- start[3], radius[3], in_air_goal[3], radius[3], camera[3], StartElement
	[1] = {1939.136,-1968.052,17.6649,2.5,2.728,3.17,1989.958,-1971.951,28.7249,11.134,5.398,7.23,1960.545,-1963.571,25.3229,false}, 
	[2] = {2209.275,-1843.686,19.0964,2.5,4.28,3.83,2215.124,-1889.359,17.7864,15.36,7.01,11.05,2203.34,-1861.524,21.8367,false}, 
	[3] = {1177.215,-1696.761,21.368,2.22,2.5,5.1,1177.972,-1626.719,32.8079,18.2,7.23,12.36,1182.92,-1659.431,29.1115,false}, 
	[4] = {2278.29,-1357.857,31.3255,2.5,2.5,3.96,2275.299,-1310.756,30.9555,10.69,2.5,9.36,2271.681,-1331.282,32.6621,false}, 
	[5] = {2335.351,-2163.947,18.5147,3.52,2.5,3.44,2344.419,-2178.703,24.2546,15.64,3.05,11.96,2336.89,-2190.321,22.4292,false}, 
	[6] = {2825.933,-1582.66,18.126,2.5,4.22,4.92,2787.504,-1569.318,27.776,2.704,19.16,14.15,2805.121,-1579.892,20.7985,false}, 
	[7] = {2460.177,-2567.911,18.8162,2.5,2.5,3.65,2464.206,-2597.455,25.8862,8.89,0.82,6.26,2454.878,-2593.787,23.9707,false}, 
	[8] = {1832.453,-2386.805,17.9247,2.5,2.5,3.01,1833.612,-2372.385,17.9247,6.57,0.5,6.65,1840.288,-2367.095,19.4731,false}, 
	[9] = {1839.745,-2514.477,16.1769,2.5,2.34,2.77,1921.679,-2517.896,20.6069,2.512,6.42,8.6999,1879.752,-2529.894,22.7841,false}, 
	[10] = {2634.397,-2107.984,17.0887,4.172,2.5,5.06,2595.646,-2109.055,25.7387,9.592,4.178,6.1,2608.7,-2117.174,21.6272,false}, 
	[11] = {2352.3,-1259.068,28.9962,2.5,2.5,2.76,2298.204,-1257.677,28.7062,2.62,20.04,9.96,2312.838,-1265.614,37.7793,false}, 
	[12] = {1013.163,-1270.362,24.4456,2.0,2.0,4.05,1045.359,-1273.475,32.9636,2.0,14.304,13.14,1037.356,-1264.502,25.3721,false}, 
	[13] = {-973.357,-223.2307,53.3717,5.35,29.1299,15.98,-1116.028,-211.0103,30.6016,49.9398,32.2599,27.0399,-1038.667,-187.1254,54.0,false}, 
	[14] = {-2637.069,780.3949,50.0166,6.76,2.52,9.29,-2639.577,733.2753,44.1565,9.91,2.52,9.29,-2633.359,757.9172,52.0809,false}, 
	[15] = {-2520.199,1169.203,59.5525,6.54,3.09,5.97,-2520.199,1202.12,53.4025,33.5399,6.21,17.66,-2513.778,1193.925,57.4115,false}, 
	[16] = {-1794.982,1211.612,35.6794,3.02,2.58,4.75,-1795.802,1258.197,32.5394,19.51,5.13,19.69,-1797.49,1238.395,37.9679,false}, 
	[17] = {-2659.551,1533.67,53.2004,2.5,2.62,4.73,-2659.551,1551.645,45.5003,7.26,11.79,18.54,-2658.426,1531.631,60.6476,false}, 
	[18] = {-1690.662,1110.392,57.2776,2.3,2.98,5.08,-1662.512,1110.392,57.2776,2.3,18.12,12.26,-1649.676,1114.14,50.8559,false}, 
	[19] = {-2145.461,-112.0259,44.3452,7.24,3.3,5.49,-2146.82,-89.4659,54.3752,4.36,3.3,14.28,-2141.051,-89.1471,45.6462,false}, 
	[20] = {-267.7739,2662.036,68.7405,3.53,4.02,6.0,-237.1135,2661.936,79.7505,7.28,12.06,8.14,-253.199,2654.016,72.7989,false}, 
	[21] = {-249.6904,2590.805,66.1194,3.68,2.96,3.96,-249.6904,2575.325,66.1194,12.66,5.21,9.68,-256.2141,2555.207,64.5246,false}, 
	[22] = {-871.5031,2308.79,164.5739,3.39,2.87,4.86,-981.079,2300.913,111.7538,18.77,40.02,69.5898,-905.3314,2315.064,163.7206,false}, 
	[23] = {2073.713,2366.653,50.8534,5.54,3.45,2.18,2050.73,2313.709,31.8133,29.69,11.19,26.09,2077.486,2318.872,26.9287,false}, 
	[24] = {2170.947,2402.609,62.2905,2.78,3.59,3.62,2183.67,2402.609,62.2905,4.92,9.2,9.8,2232.11,2387.587,50.9115,false}, 
	[25] = {2418.056,1353.234,12.3641,2.2,5.014,3.98,2481.923,1346.354,25.664,5.01,19.984,11.63,2462.313,1362.702,19.7672,false}, 
	[26] = {2407.308,1364.379,14.5734,5.16,2.72,6.0,2399.12,1386.524,25.4934,18.57,4.61,11.62,2412.772,1392.431,22.3043,false}, 
	[27] = {2784.763,2208.72,15.1934,3.05,1.76,4.33,2738.984,2208.72,21.8434,3.24,24.23,16.15,2758.656,2201.665,18.3639,false}, 
	[28] = {1482.383,2037.004,17.0576,2.09,2.69,5.58,1482.875,2077.978,23.8776,3.284,4.09,7.07,1489.125,2065.024,20.6514,false}, 
	[29] = {1976.397,2593.686,17.2126,3.67,2.0,5.44,2041.191,2593.686,30.4425,5.05,32.8,20.5,2007.676,2596.314,28.1338,false}, 
	[30] = {1636.264,2399.712,15.8903,2.5,2.5,5.08,1636.264,2449.071,15.8903,21.33,2.0,13.95,1642.17,2440.29,18.5118,false}, 
	[31] = {2119.23,2385.213,33.7094,2.1,3.36,2.6,2151.891,2385.601,30.8958,3.51,13.42,9.04,2128.102,2392.048,32.2357,false}, 
	[32] = {-2082.529,-2498.932,33.9682,2.34,2.4,3.55,-2110.031,-2479.709,40.8882,4.42,4.08,5.94,-2101.418,-2496.468,37.1704,false}, 
	[33] = {2112.408,97.9,39.993,5.64,10.28,8.05,2152.117,91.33,39.993,14.95,26.95,16.22,2149.933,76.6566,44.9509,false}, 
	[34] = {-2100.413,-1743.595,199.7312,2.94,4.27,4.96,-2082.491,-1718.923,199.7312,10.8,9.39,17.62,-2096.167,-1714.572,201.0246,false}, 
	[35] = {-2287.671,-2800.779,22.0541,5.81,13.66,5.57,-2255.133,-2800.779,22.0541,12.56,28.68,14.69,-2253.319,-2814.645,22.8247,false}, 
	[36] = {110.8902,2428.049,23.7936,3.58,3.15,4.2,132.64,2445.781,32.7336,4.38,16.62,15.35,119.7758,2449.64,27.7167,false}, 
	[37] = {-894.4963,2693.199,44.7303,3.58,2.63,2.44,-941.4026,2662.939,55.7302,29.14,16.02,19.74,-931.5991,2647.995,51.4501,false}, 
	[38] = {89.9936,-243.2046,7.5581,3.96,4.46,4.48,101.5435,-255.4345,7.5581,7.39,11.31,14.99,87.0604,-266.0403,9.8153,false}, 
	[39] = {160.7991,-160.2479,6.1453,2.12,1.452,2.23,171.8147,-162.405,12.321,2.0,7.2,7.18,183.2545,-151.314,13.5961,false}, 
	[40] = {-72.3,17.7,8.4132,2.81,2.4,4.48,-65.1154,35.7188,16.6432,7.71,2.0,7.27,-70.4781,55.8289,15.0868,false}, 
	[41] = {-39.7989,53.3007,6.9223,3.15,2.76,2.35,-36.4289,76.6106,6.9223,12.51,4.48,9.67,-42.5507,77.3671,7.8899,false}, 
	[42] = {638.7504,-520.0714,18.8519,2.0,2.15,2.34,639.8602,-545.0903,22.7619,10.97,3.01,8.26,629.1661,-542.9603,24.9594,false}, 
	[43] = {1749.723,779.6028,13.4757,1.68,2.616,2.164,1749.723,825.0914,14.2657,10.718,2.616,5.824,1744.046,799.4149,12.6554,false}, 
	[44] = {110.2446,-257.9929,6.2739,3.36,3.32,2.93,92.4846,-245.6928,11.0439,8.43,6.92,3.99,92.9552,-254.6195,10.1539,false}, 
	[45] = {2125.642,95.2542,37.3959,3.83,4.09,2.57,2098.51,99.5841,35.8559,3.83,8.46,5.72,2116.393,88.0306,40.2113,false}, 
	[46] = {-344.6466,-9.8812,44.9609,14.26,3.45,3.8,-336.1166,28.7688,37.7609,16.09,4.55,6.29,-358.2565,15.6353,41.7241,false}, 
	[47] = {-2589.18,1164.37,59.8256,2.84,2.77,2.23,-2567.125,1231.183,47.0362,18.9,9.04,6.05,-2576.06,1209.225,53.549,false}, 
	[48] = {-2292.044,1097.71,84.7347,2.082,2.074,2.02,-2350.591,1101.928,64.1846,4.522,14.204,9.03,-2323.731,1106.665,77.177,false}, 
	[49] = {-2408.285,723.2977,38.6835,2.62,2.5,1.69,-2408.285,723.2977,38.6835,22.41,2.58,4.06,-2407.981,716.5809,38.4334,false}, 
	[50] = {-2116.356,925.6832,87.819,2.68,1.99,2.48,-2069.565,925.433,76.689,2.68,15.26,14.46,-2085.629,935.5674,85.4677,false}, 
	[51] = {-1903.192,223.3468,37.7965,1.75,1.84,1.7,-1874.382,223.3467,42.4064,1.75,8.13,4.67,-1897.039,219.1329,39.911,false}, 
	[52] = {-1687.323,-162.201,17.8603,2.68,3.19,2.2,-1722.537,-126.391,14.9903,9.09,7.13,13.07,-1716.878,-142.6182,14.6114,false}, 
	[53] = {-1729.924,-364.5276,18.2246,2.268,2.51,2.148,-1777.487,-364.2776,17.9446,2.268,15.33,7.068,-1745.84,-355.4089,14.2197,false}, 
	[54] = {-1972.099,-543.0899,38.9862,1.96,2.01,1.77,-1912.318,-543.0899,45.3462,7.58,14.78,8.69,-1942.915,-539.1157,40.2453,false}, 
	[55] = {2770.214,-1177.477,70.7527,2.344,1.99,2.172,2814.468,-1182.996,55.7938,5.94,17.38,31.52,2766.031,-1184.692,74.9193,false}, 
	[56] = {2248.838,-2463.258,15.1049,5.18,2.26,2.59,2247.468,-2432.427,21.8068,12.44,2.26,9.32,2240.757,-2446.201,16.8109,false}, 
	[57] = {2248.832,-2627.623,15.1806,4.862,2.144,2.556,2248.832,-2655.498,21.2585,8.68,2.144,8.498,2237.695,-2650.768,16.3791,false}, 
	[58] = {2326.122,-1508.751,27.0066,2.242,1.728,2.08,2286.813,-1508.732,30.3748,3.86,9.38,8.99,2299.404,-1514.596,29.8683,false}, 
	[59] = {1623.574,-1110.956,61.8178,1.656,2.014,1.836,1623.574,-1079.265,61.8178,17.246,2.014,22.1459,1615.633,-1093.8,64.8724,false}, 
	[60] = {1679.646,-962.2209,65.6737,1.694,2.49,1.94,1679.646,-988.7401,65.6737,13.124,2.49,16.74,1683.881,-977.1464,65.7485,false}, 
	[61] = {1667.167,-992.8579,32.7591,6.32,3.768,2.48,1675.805,-1008.297,32.7591,18.7479,2.438,9.79,1689.156,-1013.63,35.6715,false}, 
	[62] = {347.0,-1662.299,35.8218,3.12,2.65,2.61,351.6596,-1700.264,35.8218,19.91,4.13,29.76,337.9746,-1676.993,36.7335,false}, 
	[63] = {743.1525,-1132.819,25.7991,1.834,3.606,2.35,710.0014,-1132.989,25.7991,1.834,11.096,10.0,717.1129,-1136.549,25.5161,false}, 
	[64] = {1395.562,-1460.566,12.3906,1.672,1.97,1.75,1402.96,-1447.466,17.7266,10.062,1.97,5.15,1395.023,-1450.836,17.1621,false}, 
	[65] = {1586.489,312.8876,23.9965,2.15,6.38,1.99,1540.208,325.3573,28.9665,2.15,32.8899,11.37,1562.912,331.3251,23.6496,false}, 
	[66] = {2058.1,-2677.517,15.4946,3.1,2.48,2.6,2009.261,-2677.517,20.8946,1.93,16.5499,11.26,2036.566,-2685.281,13.2053,false}, 
	[67] = {586.0102,-1773.769,15.2312,2.0,2.27,1.78,627.7189,-1781.119,22.6912,2.0,7.06,9.94,598.5319,-1778.481,17.0529,false}, 
	[68] = {2172.078,2430.507,61.747,2.12,3.3,2.35,2191.592,2436.304,53.057,2.5,12.57,25.22,2227.234,2436.885,37.788,false}, 
	[69] = {2176.133,2268.196,13.4683,2.286,1.934,1.938,2137.272,2268.246,16.7183,2.286,10.554,6.458,2148.601,2264.892,13.6634,false}, 
	[70] = {-2213.773,-311.0786,38.5339,1.15,3.04,2.59,-2213.773,-327.8282,44.6738,10.374,3.04,5.93,-2215.977,-325.7729,42.5119,false}, 
}




for i, v in pairs(Unique_Jumps) do
	Unique_Jumps[i][16] = createColCuboid(v[1]-(v[4]/2), v[2]-(v[5]/2), v[3]-(v[6]/2), v[4], v[5], v[6])
	
	setElementData(Unique_Jumps[i][16], "Jump_Start", i)
end



function JumpEvent()
	local theVehicle = getPedOccupiedVehicle(localPlayer)
	if(theVehicle) then
		if(isVehicleOnGround(theVehicle)) then
			StopJump()
		else
			local x,y,z = getElementPosition(theVehicle)
			local x2,y2,z2 = Unique_Jumps[getElementData(Jump, "Jump_End")][13], Unique_Jumps[getElementData(Jump, "Jump_End")][14], Unique_Jumps[getElementData(Jump, "Jump_End")][15]
			setCameraMatrix(x2,y2,z2, x,y,z)
		end
	else
		StopJump()
	end
end



function StopJump()
	removeEventHandler("onClientRender", root, JumpEvent)
	destroyElement(Jump)
	Jump = false
	setGameSpeed(GameSpeed)
	setCameraTarget(localPlayer)
end




function getArrSize(arr)
	local i = 0
	for _,_ in pairs(arr) do i=i+1 end
	return i
end


function onClientColShapeHit(theElement, matchingDimension)
	local theVehicle = getPedOccupiedVehicle(localPlayer)
	if(theVehicle) then
		if(theElement == theVehicle) then
			if(matchingDimension) then
				if(getElementData(source, "Jump_Start")) then
					if(not Jump) then
						local v = Unique_Jumps[getElementData(source, "Jump_Start")]
						Jump = createColCuboid(v[7]-(v[10]/2), v[8]-(v[11]/2), v[9]-(v[12]/2), v[10], v[11], v[12])
						setElementData(Jump, "Jump_End", getElementData(source, "Jump_Start"))
							
						setTimer(function()
							addEventHandler("onClientRender", root, JumpEvent)
							GameSpeed = getGameSpeed()
							setGameSpeed(0.5)
						end, 200, 1) -- Задержка чтобы машина успела оторваться от земли
					end
				elseif(getElementData(source, "Jump_End")) then
					destroyElement(Unique_Jumps[getElementData(source, "Jump_End")][16])
					Unique_Jumps[getElementData(source, "Jump_End")] = nil
					triggerServerEvent("AddPlayerMoney", localPlayer, localPlayer, 500, "Уникальный прыжок "..(70-getArrSize(Unique_Jumps)).." / 70")

					StopJump()
				end
			end
		end
	end
end
addEventHandler("onClientColShapeHit", root, onClientColShapeHit)







local PData = {}






function PlayerVehicleExit(theVehicle, seat)
	if(source == localPlayer) then 
		if(seat == 0) then
			PData = {}
		end
	end
end
addEventHandler("onClientPlayerVehicleExit", getRootElement(), PlayerVehicleExit)


local VehicleType = {
	[441] = "RC", 
	[464] = "RC", 
	[594] = "RC", 
	[501] = "RC", 
	[465] = "RC", 
	[564] = "RC", 
}
function GetVehicleType(theVehicle)
	if(isElement(theVehicle)) then theVehicle = getElementModel(theVehicle) end
	return VehicleType[theVehicle] or getVehicleType(theVehicle)
end




function MinusToPlus(var)
	if(var < 0) then
		var = var-var-var
	end
	return var
end



function math.round(number, decimals, method)
    decimals = decimals or 0
    local factor = 10 ^ decimals
    if (method == "ceil" or method == "floor") then return math[method](number * factor) / factor
    else return tonumber(("%."..decimals.."f"):format(number)) end
end





function updateWorld()
	local theVehicle = getPedOccupiedVehicle(localPlayer)
	if(theVehicle) then
		if(getElementDimension(localPlayer) == 0 or getElementData(localPlayer, "City")) then
			if(GetVehicleType(theVehicle) == "Automobile" or GetVehicleType(theVehicle) == "Bike") then
				if(not isVehicleOnGround(theVehicle)) then
					if(not PData["jump"]) then 
						PData["jump"] = {0} 
						PData["jump"][2], PData["jump"][3], PData["jump"][4] = getElementPosition(theVehicle)
						PData["jump"][5], PData["jump"][6], PData["jump"][7] = getElementRotation(theVehicle)
						PData["jump"][8], PData["jump"][9], PData["jump"][10] = 0, 0, 0
					end
					PData["jump"][1] = PData["jump"][1]+0.5
					if(PData["jump"][1] >= 10) then
						--RageInfo(Text("Отрыв от земли +{points}", {{"{points}", math.round(PData["jump"][1], 0)}}))
						
						local rx,ry,rz = getElementRotation(theVehicle)
						PData["jump"][8] = math.round(PData["jump"][8]+MinusToPlus(math.sin(rx-PData["jump"][5])), 0)
						PData["jump"][9] = math.round(PData["jump"][9]+MinusToPlus(math.sin(ry-PData["jump"][6])), 0)
						PData["jump"][10] = math.round(PData["jump"][10]+MinusToPlus(math.sin(rz-PData["jump"][7])), 0)
						
						PData["jump"][5], PData["jump"][6], PData["jump"][7] = getElementRotation(theVehicle)
						
					end
				else
					if(PData["jump"]) then
						if(PData["jump"][1] >= 10) then
							local x,y,z = getElementPosition(theVehicle)
							local jumph = math.floor(PData["jump"][4]-z, 1)
							if(jumph < 0) then jumph = jumph-jumph-jumph end
							if(jumph > 10) then
								local salto = (math.round(PData["jump"][8]/360, 0))+(math.round(PData["jump"][9]/360, 0))+(math.round(PData["jump"][10]/360, 0))
								triggerEvent("helpmessageEvent", localPlayer, "Дистанция: "..math.floor(getDistanceBetweenPoints2D(PData["jump"][2], PData["jump"][3], x,y), 1)..
								"м Высота: "..jumph.."м "..
								"Переворотов: "..salto..
								" Вращение: "..PData["jump"][8]+PData["jump"][9]+PData["jump"][10].."°")
							end
						end
						PData["jump"] = nil
					end
				end
			end
		end
	end
end
setTimer(updateWorld, 50, 0)




